<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Glassmorphism Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- Variable Definitions --- */
        :root {
            --font-family: 'Inter', sans-serif;

            /* Dark Theme Colors */
            --bg-gradient-start-dark: #4e3a75;
            --bg-gradient-end-dark: #2c2141;
            --calculator-bg-dark: rgba(44, 33, 65, 0.4);
            --button-bg-dark: rgba(255, 255, 255, 0.07);
            --button-hover-bg-dark: rgba(255, 255, 255, 0.15);
            --text-color-primary-dark: #ffffff;
            --text-color-secondary-dark: #c0b8d0;
            --operator-color-dark: #e8a0ff;
            --equals-bg-dark: #e8a0ff;
            --equals-hover-bg-dark: #d980ff;
            --equals-text-dark: #3a2d5c;

            /* Light Theme Colors */
            --bg-gradient-start-light: #f3eefc;
            --bg-gradient-end-light: #dcd3e9;
            --calculator-bg-light: rgba(255, 255, 255, 0.6);
            --button-bg-light: rgba(255, 255, 255, 0.5);
            --button-hover-bg-light: rgba(255, 255, 255, 0.9);
            --text-color-primary-light: #3a2d5c;
            --text-color-secondary-light: #5c4b8c;
            --operator-color-light: #8c52ff;
            --equals-bg-light: #8c52ff;
            --equals-hover-bg-light: #7b42f5;
            --equals-text-light: #ffffff;
        }

        /* --- Keyframe Animations --- */
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Base Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: var(--font-family);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            transition: background 0.5s ease;
        }

        body.dark {
            background: linear-gradient(135deg, var(--bg-gradient-start-dark), var(--bg-gradient-end-dark));
            background-size: 200% 200%;
            animation: gradient-animation 15s ease infinite;
        }

        body.light {
            background: linear-gradient(135deg, var(--bg-gradient-start-light), var(--bg-gradient-end-light));
            background-size: 200% 200%;
            animation: gradient-animation 15s ease infinite;
        }

        /* --- Calculator Container --- */
        .calculator-container {
            position: relative;
            width: clamp(300px, 90vw, 380px); /* Responsive width */
            padding: 2rem;
            border-radius: 2.5rem; /* Softer corners */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(25px); /* Enhanced glass effect */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: background-color 0.5s ease;
        }

        body.dark .calculator-container {
            background: var(--calculator-bg-dark);
        }

        body.light .calculator-container {
            background: var(--calculator-bg-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
        }

        /* --- Theme Toggle --- */
        .theme-toggle {
            position: absolute;
            top: 1.8rem;
            left: 2rem;
            cursor: pointer;
            z-index: 10;
            opacity: 0.7;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .theme-toggle:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .theme-toggle svg {
            width: 28px;
            height: 28px;
        }

        body.dark .theme-toggle .sun-icon { display: none; }
        body.dark .theme-toggle .moon-icon { display: block; color: var(--text-color-primary-dark); }
        body.light .theme-toggle .moon-icon { display: none; }
        body.light .theme-toggle .sun-icon { display: block; color: var(--text-color-primary-light); }

        /* --- Calculator Screen --- */
        .calculator-screen {
            width: 100%;
            text-align: right;
            padding: 1.5rem 0.5rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .screen-expression {
            height: 2rem;
            font-size: clamp(1rem, 4vw, 1.25rem); /* Responsive font size */
            font-weight: 300;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.5s ease;
        }

        .screen-result {
            font-size: clamp(2.5rem, 10vw, 3.75rem); /* Responsive font size */
            font-weight: 700;
            line-height: 1.1;
            word-wrap: break-word;
            transition: color 0.5s ease;
        }

        body.dark .screen-expression { color: var(--text-color-secondary-dark); }
        body.dark .screen-result { color: var(--text-color-primary-dark); }
        body.light .screen-expression { color: var(--text-color-secondary-light); }
        body.light .screen-result { color: var(--text-color-primary-light); }

        /* --- Calculator Buttons --- */
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .btn {
            font-family: var(--font-family);
            font-size: clamp(1.25rem, 5vw, 1.5rem);
            font-weight: 400;
            border: none;
            border-radius: 1.25rem;
            aspect-ratio: 1 / 1; /* Makes buttons perfectly square */
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            transform: scale(0.94);
        }

        /* Light & Dark Mode Button Styles */
        body.dark .btn {
            background: var(--button-bg-dark);
            color: var(--text-color-primary-dark);
        }
        body.dark .btn:hover {
            background: var(--button-hover-bg-dark);
        }
        body.dark .btn-operator {
            color: var(--operator-color-dark);
            font-weight: 300;
        }
        body.dark .btn-equals {
            background: var(--equals-bg-dark);
            color: var(--equals-text-dark);
        }
        body.dark .btn-equals:hover {
            background: var(--equals-hover-bg-dark);
        }

        body.light .btn {
            background: var(--button-bg-light);
            color: var(--text-color-primary-light);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        body.light .btn:hover {
            background: var(--button-hover-bg-light);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        body.light .btn-operator {
            color: var(--operator-color-light);
        }
        body.light .btn-equals {
            background: var(--equals-bg-light);
            color: var(--equals-text-light);
        }
        body.light .btn-equals:hover {
            background: var(--equals-hover-bg-light);
        }

        .btn-equals {
            grid-column: 4 / 5;
            grid-row: 4 / 6;
            aspect-ratio: auto; /* Override for the tall equals button */
            height: auto;
            border-radius: 1.25rem;
        }

        .btn-operator svg {
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body class="dark">

    <div class="calculator-container">
        <!-- Theme Toggle -->
        <div class="theme-toggle">
            <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </div>

        <!-- Calculator Screen -->
        <div class="calculator-screen">
            <div class="screen-expression"></div>
            <div class="screen-result">0</div>
        </div>

        <!-- Calculator Buttons -->
        <div class="calculator-buttons">
            <button class="btn btn-operator" data-key="clear">C</button>
            <button class="btn btn-operator" data-key="/">÷</button>
            <button class="btn btn-operator" data-key="*">×</button>
            <button class="btn btn-operator" data-key="backspace">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
            </button>

            <button class="btn btn-number" data-key="7">7</button>
            <button class="btn btn-number" data-key="8">8</button>
            <button class="btn btn-number" data-key="9">9</button>
            <button class="btn btn-operator" data-key="-">-</button>

            <button class="btn btn-number" data-key="4">4</button>
            <button class="btn btn-number" data-key="5">5</button>
            <button class="btn btn-number" data-key="6">6</button>
            <button class="btn btn-operator" data-key="+">+</button>

            <button class="btn btn-number" data-key="1">1</button>
            <button class="btn btn-number" data-key="2">2</button>
            <button class="btn btn-number" data-key="3">3</button>
            <button class="btn btn-equals" data-key="=">=</button>

            <button class="btn btn-operator" data-key="%">%</button>
            <button class="btn btn-number" data-key="0">0</button>
            <button class="btn btn-number" data-key=".">.</button>
        </div>
    </div>

    <script>
        // script.js
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element Selectors ---
            const themeToggle = document.querySelector('.theme-toggle');
            const body = document.body;
            const expressionDisplay = document.querySelector('.screen-expression');
            const resultDisplay = document.querySelector('.screen-result');
            const buttons = document.querySelector('.calculator-buttons');

            // --- State Variables ---
            let currentInput = '0';
            let expression = '';
            let operator = null;
            let previousValue = null;
            let shouldResetScreen = false;

            // --- Theme Toggle Logic ---
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('light');
                body.classList.toggle('dark');
            });

            // --- Update Display Function ---
            const updateDisplay = () => {
                resultDisplay.textContent = formatNumber(currentInput);
                // Only show expression if it's not just a result display
                if (expression.includes('=')) {
                    expressionDisplay.textContent = expression;
                } else {
                    expressionDisplay.textContent = expression.replace(/(\d+)/g, (num) => formatNumber(num));
                }
            };
            
            // --- Format Number with Commas ---
            const formatNumber = (numStr) => {
                if (typeof numStr !== 'string') numStr = String(numStr);
                if (numStr.includes('Infinity') || numStr.includes('NaN')) return 'Error';
                const [integerPart, decimalPart] = numStr.split('.');
                const formattedInteger = parseFloat(integerPart).toLocaleString('en-US', {
                    maximumFractionDigits: 0
                });
                return decimalPart !== undefined ? `${formattedInteger}.${decimalPart}` : formattedInteger;
            };

            // --- Calculation Logic ---
            const calculate = (val1, op, val2) => {
                const num1 = parseFloat(val1);
                const num2 = parseFloat(val2);
                if (op === '+') return num1 + num2;
                if (op === '-') return num1 - num2;
                if (op === '*') return num1 * num2;
                if (op === '/') {
                    if (num2 === 0) return 'Infinity'; // Division by zero
                    return num1 / num2;
                }
                return num2;
            };

            // --- Button Click Handler ---
            buttons.addEventListener('click', (e) => {
                if (!e.target.closest('.btn')) return;
                const button = e.target.closest('.btn');

                const key = button.dataset.key;
                const keyType = button.classList.contains('btn-number') ? 'number'
                              : button.classList.contains('btn-operator') ? 'operator'
                              : 'special'; // equals, clear, backspace

                handleKeyPress(key, keyType);
            });

            // --- Key Press Logic ---
            const handleKeyPress = (key, keyType) => {
                if (keyType === 'number') {
                    if (currentInput === '0' || shouldResetScreen) {
                        currentInput = '';
                        shouldResetScreen = false;
                    }
                    if (key === '.' && currentInput.includes('.')) return; // Prevent multiple decimals
                    currentInput += key;
                }

                if (keyType === 'operator') {
                    if (operator && previousValue !== null && !shouldResetScreen) {
                        const result = calculate(previousValue, operator, currentInput);
                        previousValue = String(result);
                        currentInput = previousValue;
                    } else {
                        previousValue = currentInput;
                    }
                    
                    operator = key;
                    expression = `${formatNumber(previousValue)} ${key === '/' ? '÷' : key === '*' ? '×' : key}`;
                    shouldResetScreen = true;

                    if (key === '%') {
                        currentInput = String(parseFloat(previousValue) / 100);
                        expression = '';
                        operator = null;
                        previousValue = null;
                        shouldResetScreen = false;
                    }
                }
                
                if (key === 'backspace') {
                    if (shouldResetScreen) return;
                    currentInput = currentInput.slice(0, -1);
                    if (currentInput === '') {
                        currentInput = '0';
                    }
                }

                if (key === '=') {
                    if (operator && previousValue !== null) {
                        const result = calculate(previousValue, operator, currentInput);
                        expression = `${formatNumber(previousValue)} ${operator === '/' ? '÷' : operator === '*' ? '×' : operator} ${formatNumber(currentInput)} =`;
                        currentInput = String(result);
                        operator = null;
                        previousValue = null;
                        shouldResetScreen = true;
                    }
                }

                if (key === 'clear') {
                    currentInput = '0';
                    expression = '';
                    operator = null;
                    previousValue = null;
                    shouldResetScreen = false;
                }

                updateDisplay();
            };

            // --- Initial Display Update ---
            updateDisplay();
        });
    </script>
</body>
</html>
